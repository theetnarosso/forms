
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Etna Rosso Feedback</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fafafa;
      padding: 2rem;
    }
    .form-container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
    }
    .stars {
      display: flex;
      flex-direction: row;
      gap: 4px;
      font-size: 1.8rem;
      cursor: pointer;
    }
    .category {
      margin-top: 1rem;
    }
    .hidden {
      display: none;
    }
    .red {
      color: red;
    }
    textarea, input, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: vertical;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.75rem;
      background: #c62828;
      color: white;
      border: none;
      border-radius: 5px;
      width: 100%;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>How was your experience?</h2>
    <p style="text-align: center;">At The Etna Rosso, we personally read every message. Please rate your experience and help us serve you even better next time.</p>

    <div class="category">
      <label><strong>Overall</strong></label>
      <div class="stars" id="overall-stars"></div>
    </div>

    <div id="extended-form" class="hidden">
      <div class="category">
        <label for="name"><strong>Your Name</strong></label>
        <input type="text" id="name" name="name" placeholder="Optional">
      </div>

      <div class="category">
        <label for="visit-date"><strong>When did you visit?</strong></label>
        <input type="date" id="visit-date" name="visit-date">
      </div>

      <div class="category">
        <label><strong>Food</strong></label>
        <div class="stars" data-category="Food"></div>
      </div>

      <div class="category">
        <label><strong>Service</strong></label>
        <div class="stars" data-category="Service"></div>
      </div>

      <div class="category">
        <label><strong>Atmosphere</strong></label>
        <div class="stars" data-category="Atmosphere"></div>
      </div>

      <div class="category">
        <label><strong>Wait time</strong></label>
        <div class="stars" data-category="Wait time"></div>
      </div>

      <div class="category">
        <label><strong>We’re sorry it wasn’t perfect. Please help us understand, your feedback is valuable to us</strong></label>
        <textarea id="feedback" rows="4" placeholder="Your feedback..."></textarea>
      </div>
    </div>

    <form id="feedback-form" action="https://formspree.io/f/meolapyq" method="POST">
      <input type="hidden" name="overallRating" id="overallRating">
      <input type="hidden" name="extendedData" id="extendedData">
      <button type="submit">Submit Feedback</button>
    </form>
  </div>

  <script>
    const overallStars = document.getElementById("overall-stars");
    const extendedForm = document.getElementById("extended-form");
    const overallRatingInput = document.getElementById("overallRating");
    const extendedDataInput = document.getElementById("extendedData");
    const redirectURL = "https://g.page/r/CTXbAU8V6jQYEAI/review";

    function renderStars(container, onSelect) {
      container.innerHTML = "";
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.innerHTML = "&#9733;";
        star.dataset.value = i;
        star.classList.add("star");
        star.style.color = "#aaa";
        star.addEventListener("click", () => {
          [...container.children].forEach((s, idx) => {
            s.style.color = idx < i ? "red" : "#aaa";
          });
          onSelect(i);
        });
        container.appendChild(star);
      }
    }

    let overallValue = 0;
    renderStars(overallStars, (val) => {
      overallValue = val;
      overallRatingInput.value = val;
      if (val <= 3) {
        extendedForm.classList.remove("hidden");
      } else {
        window.location.href = redirectURL;
      }
    });

    // Additional categories
    document.querySelectorAll(".stars[data-category]").forEach(starSet => {
      renderStars(starSet, () => {});
    });

    // Capture extended data on submit
    document.getElementById("feedback-form").addEventListener("submit", function (e) {
      if (overallValue <= 3) {
        const data = {
          name: document.getElementById("name").value,
          visitDate: document.getElementById("visit-date").value,
          food: starValue("Food"),
          service: starValue("Service"),
          atmosphere: starValue("Atmosphere"),
          waitTime: starValue("Wait time"),
          message: document.getElementById("feedback").value
        };
        extendedDataInput.value = JSON.stringify(data);
      }
    });

    function starValue(category) {
      const stars = document.querySelector(`.stars[data-category='${category}']`).children;
      let count = 0;
      for (const star of stars) {
        if (star.style.color === "red") count++;
      }
      return count;
    }
  </script>
</body>
</html>
